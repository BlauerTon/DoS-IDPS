└──╼ $cat templates/index.html
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>IDPS Dashboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.7.5/socket.io.min.js"></script>
    <style>
        /* Scrollbar styling for logs and lists */
        #alert-log::-webkit-scrollbar, #blocked-ips-list::-webkit-scrollbar {
            width: 8px;
        }
        #alert-log::-webkit-scrollbar-track, #blocked-ips-list::-webkit-scrollbar-track {
            background: #2d3748;
        }
        #alert-log::-webkit-scrollbar-thumb, #blocked-ips-list::-webkit-scrollbar-thumb {
            background: #4a5568;
            border-radius: 4px;
        }
        #alert-log::-webkit-scrollbar-thumb:hover, #blocked-ips-list::-webkit-scrollbar-thumb:hover {
            background: #718096;
        }

        /* Modal transitions */
        #alert-modal {
            transition: opacity 0.20s ease-in-out;
        }
        .modal-hidden { opacity: 0; pointer-events: none; }
        .modal-visible { opacity: 1; pointer-events: auto; }

        /* Small visual adjustments */
        .stat-number { letter-spacing: -0.02em; }
        .card-title { color: #9aa4b2; font-size: 0.75rem; letter-spacing: 0.08em; text-transform: uppercase; }
    </style>
</head>
<body class="bg-gray-900 text-white font-sans">

    <!-- Header -->
    <header class="bg-gray-800 shadow-sm">
        <div class="container mx-auto px-4 py-4 flex justify-between items-center">
            <h1 class="text-2xl font-semibold">Real-time IDPS Dashboard</h1>
            <div class="flex items-center space-x-3">
                <div id="connection-status-dot" class="w-3 h-3 bg-red-500 rounded-full"></div>
                <span id="connection-status-text" class="text-sm text-gray-300">Connecting...</span>
            </div>
        </div>
    </header>

    <!-- Main -->
    <main class="container mx-auto p-4 mt-4">

        <!-- Stats row -->
        <div class="grid grid-cols-1 md:grid-cols-3 lg:grid-cols-5 gap-4">
            <div id="status-card" class="bg-gray-800 rounded-lg shadow-md p-6 border-l-4 border-blue-500">
                <div class="card-title">System Status</div>
                <div id="status-text" class="text-3xl font-bold text-blue-400 mt-2">MONITORING</div>
            </div>

            <div class="bg-gray-800 rounded-lg shadow-md p-6">
                <div class="card-title">Packets per second</div>
                <div id="pps-stat" class="text-3xl font-bold mt-2 stat-number">0</div>
            </div>

            <div class="bg-gray-800 rounded-lg shadow-md p-6">
                <div class="card-title">Traffic</div>
                <div id="bps-stat" class="text-3xl font-bold mt-2 stat-number">0 B/s</div>
            </div>

            <div class="bg-gray-800 rounded-lg shadow-md p-6">
                <div class="card-title">Active Flows</div>
                <div id="active-flows" class="text-3xl font-bold mt-2 stat-number">0</div>
            </div>

            <div class="bg-gray-800 rounded-lg shadow-md p-6">
                <div class="card-title">Blocked IPs</div>
                <div id="blocked-ips-count" class="text-3xl font-bold mt-2 stat-number">0</div>
            </div>
        </div>

        <!-- Alerts and blocked list -->
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-4 mt-6">

            <!-- Live Event Log -->
            <section class="bg-gray-800 rounded-lg shadow-md p-6">
                <h2 class="text-lg font-semibold mb-4">Live Event Log</h2>
                <div id="alert-log" class="h-64 overflow-y-auto space-y-3 pr-2 text-sm">
                    <p class="text-gray-500">Waiting for events...</p>
                </div>
            </section>

            <!-- Blocked IPs -->
            <section class="bg-gray-800 rounded-lg shadow-md p-6">
                <h2 class="text-lg font-semibold mb-4">Currently Blocked IPs</h2>
                <div id="blocked-ips-list" class="h-64 overflow-y-auto space-y-2 pr-2 text-sm">
                    <p class="text-gray-500">No IPs blocked.</p>
                </div>
            </section>

        </div>
    </main>

    <!-- Professional alert modal -->
    <div id="alert-modal" class="modal-hidden fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50">
        <div class="bg-gray-800 rounded-lg shadow-2xl p-6 w-full max-w-2xl mx-4 border border-red-600">
            <div class="flex items-start justify-between space-x-4">
                <div>
                    <div class="text-xl font-semibold text-red-400">Threat Detection Alert</div>
                    <div class="text-sm text-gray-400 mt-1">A network flow has been flagged by the detection model. Review the indicators below and acknowledge once reviewed.</div>
                </div>
                <div class="ml-auto">
                    <button id="close-modal-btn" class="text-gray-400 hover:text-white px-3 py-1 rounded">Close</button>
                </div>
            </div>

            <div id="modal-alert-content" class="mt-6 grid grid-cols-1 md:grid-cols-3 gap-4 text-sm text-gray-300">

                <!-- JS will populate summary, indicators, and flow details here -->

            </div>

            <div class="mt-6 flex justify-end">
                <button id="close-modal-btn-bottom" class="bg-red-600 hover:bg-red-700 text-white font-semibold py-2 px-4 rounded">Acknowledge</button>
            </div>
        </div>
    </div>

    <script>
        const socket = io();

        // DOM references
        const connDot = document.getElementById('connection-status-dot');
        const connText = document.getElementById('connection-status-text');

        const statusCard = document.getElementById('status-card');
        const statusText = document.getElementById('status-text');

        const ppsStatEl = document.getElementById('pps-stat');
        const bpsStatEl = document.getElementById('bps-stat');
        const activeFlowsEl = document.getElementById('active-flows');
        const blockedIPsCountEl = document.getElementById('blocked-ips-count');

        const alertLog = document.getElementById('alert-log');
        const blockedIPsList = document.getElementById('blocked-ips-list');

        const alertModal = document.getElementById('alert-modal');
        const modalContent = document.getElementById('modal-alert-content');
        const closeModalBtn = document.getElementById('close-modal-btn');
        const closeModalBtnBottom = document.getElementById('close-modal-btn-bottom');

        // Track rendered blocked IPs
        let renderedBlockedIPs = new Set();

        // Helper: add entry to a log container
        function addToLog(container, message, type = 'info') {
            // Limit items to latest 50
            while (container.children.length > 50) {
                container.removeChild(container.firstChild);
            }

            // Remove placeholder
            if (container.children[0] && container.children[0].innerText === 'Waiting for events...') {
                container.innerHTML = '';
            }

            const el = document.createElement('div');
            const time = new Date().toLocaleTimeString();
            let colorClass = 'bg-gray-700 border border-gray-600';
            if (type === 'alert') {
                colorClass = 'bg-red-900 border border-red-700';
            } else if (type === 'warning') {
                colorClass = 'bg-yellow-900 border border-yellow-700';
            } else if (type === 'normal') {
                colorClass = 'bg-green-900 border border-green-700';
            }

            el.className = `p-3 rounded-lg text-sm font-mono ${colorClass}`;
            el.innerText = `[${time}] ${message}`;
            container.appendChild(el);
            container.scrollTop = container.scrollHeight;
        }

        // Helper: human readable bytes per second
        function formatBytes(bytes, decimals = 2) {
            if (bytes === 0) return '0 B/s';
            const k = 1024;
            const dm = decimals < 0 ? 0 : decimals;
            const sizes = ['B/s', 'KB/s', 'MB/s', 'GB/s', 'TB/s'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return parseFloat((bytes / Math.pow(k, i)).toFixed(dm)) + ' ' + sizes[i];
        }

        // Modal show/hide
        function showModal(alertData) {
            // Build a professional, structured layout: Summary, Indicators, Flow Details
            modalContent.innerHTML = `
                <div class="md:col-span-2">
                    <div class="text-sm text-gray-300 font-medium mb-2">Summary</div>
                    <div class="text-sm text-gray-400 leading-snug">
                        The detection model classified a flow as high risk. Please review indicators, check source and destination, and take action if needed.
                    </div>
                </div>

                <div>
                    <div class="text-sm text-gray-300 font-medium mb-2">Key Indicators</div>
                    <div class="text-sm text-gray-400 space-y-2">
                        <div><strong class="text-gray-300">Attack probability:</strong> ${alertData.prob_attack}</div>
                        <div><strong class="text-gray-300">Packet rate:</strong> ${alertData.rate} pkt/s</div>
                        <div><strong class="text-gray-300">Packet count:</strong> ${alertData.packets}</div>
                    </div>
                </div>

                <div class="md:col-span-3">
                    <div class="mt-2 text-sm text-gray-300 font-medium mb-1">Flow details</div>
                    <div class="bg-gray-700 rounded p-3 font-mono text-sm text-gray-200 break-words">
                        ${alertData.flow_id}
                    </div>
                </div>
            `;

            alertModal.classList.remove('modal-hidden');
            alertModal.classList.add('modal-visible');
        }

        function hideModal() {
            alertModal.classList.remove('modal-visible');
            alertModal.classList.add('modal-hidden');
        }

        closeModalBtn.onclick = hideModal;
        closeModalBtnBottom.onclick = hideModal;

        // Socket events
        socket.on('connect', () => {
            connDot.classList.remove('bg-red-500');
            connDot.classList.add('bg-green-500');
            connText.innerText = 'Connected';
            addToLog(alertLog, 'Connected to backend', 'normal');
        });

        socket.on('disconnect', () => {
            connDot.classList.remove('bg-green-500');
            connDot.classList.add('bg-red-500');
            connText.innerText = 'Disconnected';
            addToLog(alertLog, 'Disconnected from backend', 'warning');
        });

        socket.on('update_stats', (data) => {
            // Update small stat cards
            try {
                ppsStatEl.innerText = Number(data.pps).toFixed(0);
            } catch { ppsStatEl.innerText = '0'; }
            try {
                bpsStatEl.innerText = formatBytes(Number(data.bps));
            } catch { bpsStatEl.innerText = '0 B/s'; }

            activeFlowsEl.innerText = data.active_flows ?? 0;
            blockedIPsCountEl.innerText = (data.blocked_ips_list && data.blocked_ips_list.length) ? data.blocked_ips_list.length : 0;

            // Rebuild blocked IP list incrementally
            const newBlockedIPs = new Set(data.blocked_ips_list || []);

            // Remove IPs no longer blocked
            for (const ip of Array.from(renderedBlockedIPs)) {
                if (!newBlockedIPs.has(ip)) {
                    const el = document.getElementById(`blocked-${ip}`);
                    if (el) el.remove();
                    renderedBlockedIPs.delete(ip);
                }
            }

            // Add new IPs
            for (const ip of newBlockedIPs) {
                if (!renderedBlockedIPs.has(ip)) {
                    if (blockedIPsList.children[0] && blockedIPsList.children[0].innerText === 'No IPs blocked.') {
                        blockedIPsList.innerHTML = '';
                    }
                    const el = document.createElement('div');
                    el.id = `blocked-${ip}`;
                    el.className = 'p-3 rounded-lg bg-red-800 text-sm font-mono';
                    el.innerText = `${ip}`;
                    blockedIPsList.appendChild(el);
                    renderedBlockedIPs.add(ip);
                }
            }

            // Placeholder if empty
            if (renderedBlockedIPs.size === 0) {
                blockedIPsList.innerHTML = '<p class="text-gray-500">No IPs blocked.</p>';
            }
        });

        socket.on('new_alert', (data) => {
            // Update status visuals
            statusCard.classList.remove('border-blue-500');
            statusCard.classList.add('border-red-500');
            statusText.innerText = 'ALERT';
            statusText.classList.remove('text-blue-400');
            statusText.classList.add('text-red-400');

            const msg = `Flow: ${data.flow_id} | Prob: ${data.prob_attack} | Rate: ${data.rate}/s`;
            addToLog(alertLog, msg, 'alert');

            // Open professional modal
            showModal(data);
        });

        socket.on('system_message', (data) => {
            addToLog(alertLog, data.msg, 'warning');
        });

        socket.on('flow_normal', (data) => {
            statusCard.classList.remove('border-red-500');
            statusCard.classList.add('border-blue-500');
            statusText.innerText = 'MONITORING';
            statusText.classList.remove('text-red-400');
            statusText.classList.add('text-blue-400');

            const msg = `Flow ${data.flow_id} returned to normal.`;
            addToLog(alertLog, msg, 'normal');
        });
    </script>
</body>
</html>